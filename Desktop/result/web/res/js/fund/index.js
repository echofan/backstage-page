define("fund/index",["libs/chart","libs/subscribe","libs/template"],function(t,n,i){var e=t("libs/chart"),a=t("libs/subscribe"),s=t("libs/template"),r={};s.helper("numToPercent",function(t){var n="([0-9]+).([0-9]{2})[0-9]*";return t=(100*t).toFixed(2).toString(),newNumber=t.match(n),newNumber[1]+'.<span class="float">'+newNumber[2]+"%</span>"}),s.helper("dateFormate",function(t){var n=t.substring(0,10).split("-");return n[0]+"."+n[1]+"."+n[2]});var d=function(t){this.$ele=$(t),this.$child=$("#bannerUl"),this.curSlide=0,this.timer=null,this.width=$(window).width(),this.init()};d.prototype={init:function(){this.getData()},getData:function(){var t=this,n={jsonrpc:"2.0",method:"Banner.GetWithSize",id:54321,params:{name:"fund",size:"200"}};$.Func.ajax(n,function(n){var i=n.result;i&&t.render(i)})},slide:function(){var t=this;t.timer?(clearInterval(t.timer),t.timer=null,setTimeout(function(){t.slide()},5e3)):t.timer=setInterval(function(){t.next()},5e3)},render:function(t){var n=t.data,i=s("banner-template",t),e="";$("#bannerUl").html(i),this.$child.css({width:this.width*this.$child.find("li").length+"px"}),this.$child.find("li").css({width:this.width+"px"}),$.each(n,function(t,n){e+="<li>&bull;</li>"}),$("#bannerTab").html(e),n&&n.length>1&&(this.slide(),this.bindEvent())},bindEvent:function(){var t=this;t.$ele.on("swipeleft",function(){t.next.apply(t)}),t.$ele.on("swiperight",function(){t.prev.apply(t)})},next:function(){var t=this.$child.find("li");this.curSlide++,this.curSlide>=t.length&&(this.curSlide=0),this.slideTo(this.curSlide),this.slide()},prev:function(){var t=this.$child.find("li");this.curSlide--,this.curSlide<0&&(this.curSlide=t.length-1),this.slideTo(this.curSlide),this.slide()},slideTo:function(t){var n=-t*this.width;this.$child.css({"margin-left":n+"px"}),$("#bannerTab").find("li").removeClass("on").eq(t).addClass("on")}};var c={bindEvent:function(){$("body").delegate(".js-tap","click",function(t){var n=$(this).data("handler");c[n]&&c[n].call(this)})},showMore:function(t){var n=$(this).parent(),i=$(this).data("fundid"),e=$(this).data("index"),a=$("#onRange-"+e).val();n.hasClass("on")?n.removeClass("on"):(n.addClass("on"),r.hasOwnProperty(e+a)?r[e+a].paint():c.fundHistoryPctchg(i,a,e)),c.showBtn(i,e)},showTab:function(){var t=$(this).data("range").split("-"),n=t[0],i=t[1],e=$("#onRange-"+i).data("fundid");$(this).parent().children().removeClass("on"),$(this).addClass("on"),r.hasOwnProperty(i+n)?r[i+n].paint():c.fundHistoryPctchg(e,n,i)},showBtn:function(t,n){if(!$.User.wxgzh)return $("#btn-"+n).html('<a class="btn btn-red" href="bindphone.html">绑定账号并订阅</a>').removeClass("hide"),!1;var i=$.User.userid;a.subscribeList(i,function(e){~$.inArray(t,e)?$("#btn-"+n).html('<a class="btn btn-red" href="detail.html?fundid='+t+'">查看详情</a>').removeClass("hide"):a.vipService(i,function(e){~$.inArray(t,e)?$("#btn-"+n).html('<a class="btn btn-red js-tap" data-handler="subscribe" data-fundid=" '+t+'" href="javascript:;">订阅</a>').removeClass("hide"):a.checkFundFreeStatus(i,t,function(i){1==i?$("#btn-"+n).html('<a class="btn btn-red js-tap" data-fundid="'+t+'" data-handler="subscribe" href="javascript:;">免费订阅</a>').removeClass("hide"):$("#btn-"+n).html('<a class="btn btn-red" href="../../pay/pay.html?productid='+t+'">购买</a>').removeClass("hide")})})})},fundHistoryPctchg:function(t,n,i){var e=new Date,a=$.Func.formatDate(e),s=null,r=$("#create-"+i).val(),d=0;switch(r=$.Func.formatDate(r),n){case"begin":s=r,d=0;break;case"year":s=$.Func.formatDate(e,"year"),parseInt(s)<parseInt(r)&&(s=r),d=1;break;case"month":s=$.Func.formatDate(e,"mon"),d=2}var h={jsonrpc:"2.0",method:"Fund.FundHistoryPctchg",id:54321,params:{Fundid:t,Pctchgtype:0,QueryType:d,StartDay:parseInt(s),EndDay:parseInt(a)}};$.Func.ajax(h,function(t){var e=t.result;e&&c.drawCanvas(i,n,e.data)})},subscribe:function(){var t=$(this).data("fundid").trim();return!!t&&void($.User.wxgzh?a.subscribeFund($.User.userid,t,function(n){1==n.result.status?$.Func.pop("订阅成功！",function(){setTimeout(function(){location.href=$.CONFIG.BASE+"web/fund/detail.html?fundid="+t},500)}):location.href=$.CONFIG.BASE+"pay/pay.html?productid="+t}):$.Func.showLayer("#popBindAccount"))},fundList:function(t){var n={jsonrpc:"2.0",method:"Fund.FundList",id:54321,params:{blockid:885494}};$.Func.ajax(n,function(n){var i=n.result;if(i.data){var e=s("li-template",i);$("#fundlist").html(e)}var a=$(window).width()-20;$(".canvas canvas").width(a),$.isFunction(t)&&t(i.data)})},hawkeye:function(){$.User.wxgzh?location.href="../hawkeye/index.html":$.Func.showLayer("#popBindAccount")},closeLayer:function(){$(this).parent().parent().removeClass("show")},drawCanvas:function(t,n,i){i[0].data&&i[1].data&&(r[t+n]=new e({selector:"#canvas-"+t,point:"pctchg",days:[{fillStyle:"#CC0153",data:i[0].data},{fillStyle:"#0166CE",data:i[1].data}]}))},init:function(){var t=this;$.Func.getUserInfo(),$.User.wxgzh||$.Func.showLayer("#popBindAccount");var n=[];t.fundList(function(t){$.each(t,function(t,i){n.push(i.fundid)})});new d("#banner");this.bindEvent()}};i.exports=c});